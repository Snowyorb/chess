(function(){var aa="pawn knight bishop rook queen king".split(" ");function ba(a,b){return"abcdefgh"[b]+"12345678"[a]}function ca(a){return"abcdefgh".indexOf(a[0])+8*"12345678".indexOf(a[1])}function f(a){return ba(a>>>3,a&7)};function da(a,b){this.a=a>>>0;this.b=b>>>0}function ea(a){a>>>=0;a-=a>>>1&1431655765;a=(a&858993459)+(a>>>2&858993459);return 16843009*(a+(a>>>4)&252645135)>>>24}function fa(a){a>>>=0;return(a&a-1)>>>0}function ha(a){a>>>=0;return ea((a&-a)-1)}function ia(a){return ea(a.a)+ea(a.b)}function ja(a){return a.a?ha(a.a):32+ha(a.b)}function q(a){var b=ja(a);a.a?a.a=fa(a.a):a.b=fa(a.b);return b}function t(a){return!a.a&&!a.b}function u(a,b){b>>>=0;return 32>b?!(a.a&1<<b):!(a.b&1<<b-32)}
function w(a,b){b>>>=0;32>b?a.a=(a.a|1<<b)>>>0:a.b=(a.b|1<<b-32)>>>0;return a}function ka(a,b){b>>>=0;32>b?a.a=(a.a&~(1<<b))>>>0:a.b=(a.b&~(1<<b-32))>>>0}da.prototype.and=function(a){this.a=(this.a&a.a)>>>0;this.b=(this.b&a.b)>>>0;return this};function y(a,b){a.a=(a.a&~b.a)>>>0;a.b=(a.b&~b.b)>>>0;return a}da.prototype.or=function(a){this.a=(this.a|a.a)>>>0;this.b=(this.b|a.b)>>>0;return this};da.prototype.xor=function(a){this.a=(this.a^a.a)>>>0;this.b=(this.b^a.b)>>>0;return this};
function la(a){a.a=~a.a>>>0;a.b=~a.b>>>0;return a}function z(a,b){b>>>=0;31<b?(a.b=a.a<<b-32>>>0,a.a=0):0<b&&(a.b=(a.b<<b|a.a>>>32-b)>>>0,a.a=a.a<<b>>>0);return a}function A(a,b){b>>>=0;31<b?(a.a=a.b>>>b-32,a.b=0):0<b&&(a.a=(a.a>>>b|a.b<<32-b)>>>0,a.b>>>=b);return a}function B(a,b){63<b||-63>b?a.a=a.b=0:0<b?z(a,b):0>b&&A(a,-b);return a}function ma(a,b){return a.a===b.a&&a.b===b.b}function C(a){return E(a.a,a.b)}function E(a,b){return new da(a,b)}function H(a){return w(E(0,0),a)}
function na(){var a=oa;return B(E(270549120,16909320).and(B(E(4294967295,4294967295),8*a)),a)}function pa(){var a=qa;return B(E(134480385,2151686160).and(B(E(4294967295,4294967295),8*-a)),a)}function ra(){var a=w(E(0,0),sa),b=y(A(C(a),1),J[7]),c=y(y(A(C(a),2),J[7]),J[6]),d=y(z(C(a),1),J[0]);a=y(y(z(C(a),2),J[0]),J[1]);c=c.or(a);b=b.or(d);return z(C(c),8).or(A(c,8)).or(z(C(b),16)).or(A(b,16))}
function ta(){var a=w(E(0,0),ua),b=y(A(C(a),1),J[7]).or(y(z(C(a),1),J[0])),c=A(C(a).or(b),8);a=z(C(a).or(b),8);return b.or(c).or(a)}for(var va=E(4294967295,4294967295),wa=E(1437226410,1437226410),xa=E(2857740885,2857740885),ya=[],za=0;8>za;++za)ya.push(z(E(16843009,16843009),za));for(var J=ya,L=[],Aa=0;8>Aa;++Aa)L.push(z(E(255,0),8*Aa));for(var Ba=[],oa=-7;8>oa;++oa)Ba.push(na());for(var Ca=[],qa=-7;8>qa;++qa)Ca.push(pa());for(var Da=[],sa=0;64>sa;++sa)Da.push(ra());for(var Ea=[],ua=0;64>ua;++ua)Ea.push(ta());function Fa(a,b){this.b=a>>>0;this.a=b>>>0}for(var Ga=[],Ha=0;1586>Ha;++Ha)Ga.push(1+4294967295*Math.random()>>>0);function M(a,b){a.b=(a.b^Ga[b])>>>0;a.a=(a.a^Ga[b+1])>>>0}function N(a,b){0<=b&&M(a,1570+(b&7))};function Ia(a,b,c,d,e){this.value=b&63|(a&63)<<6|(c&15)<<12|(d&7)<<16|((e|0)&7)<<19}function O(a){return a.value>>>6&63}function P(a){return a.value>>>12&15}function R(a){return a.value>>>16&7}function Ja(a){return 2===P(a)||3===P(a)}function Ka(a){return 5!==P(a)?a.value&63:(a.value&63)+(O(a)<(a.value&63)?-8:8)};function La(){this.b=new Fa(0,0);this.a=[C(L[1]).or(L[6]),H(1).or(H(6)).or(H(57)).or(H(62)),H(2).or(H(5)).or(H(58)).or(H(61)),H(0).or(H(7)).or(H(56)).or(H(63)),H(3).or(H(59)),H(4).or(H(60)),C(L[0]).or(L[1]),C(L[6]).or(L[7])];this.h=[];this.c=0;this.g=15;this.f=-1;this.l=0;this.i=[];this.j=[];for(var a=this.h.length=0;64>a;++a){var b;a:{for(b=0;5>=b;++b)if(!u(this.a[b],a))break a;b=null}this.h.push(b)}this.b=new Fa(0,0);this.c&&M(this.b,0);for(a=0;1>=a;++a)for(b=0;5>=b;++b){var c=this.b,d=b,e=a,h=
T(this,b,a);for(h=C(h);!t(h);){var k=q(h);M(c,2+d+6*e+12*k)}}M(this.b,1538+this.g);N(this.b,this.f);this.m=[]}var U=[7,63,0,56],Ma=[la(z(E(16843009,16843009),7)),va,la(z(E(16843009,16843009),0))];function V(a,b,c){c=Na(a,!!c);return b?c:c.filter(La.prototype.o,a)}function T(a,b,c){return C(a.a[b]).and(a.a[6+c])}function Oa(a){return C(a.a[6]).or(a.a[7])}function W(a){return Pa(a,a.c^1,ja(T(a,5,a.c)))}
function X(a,b,c,d){var e=E(0,0);c=8*c+d;d=Ma[1+d];for(B(a,c);!t(a.and(d));B(y(a,b),c))e.or(a);return e}function Qa(a,b){return X(C(a),b,1,1).or(X(C(a),b,1,-1)).or(X(C(a),b,-1,1)).or(X(C(a),b,-1,-1))}function Ra(a,b){return X(C(a),b,0,1).or(X(C(a),b,0,-1)).or(X(C(a),b,1,0)).or(X(C(a),b,-1,0))}
function Pa(a,b,c){var d=T(a,0,b),e=0===b;var h=B(y(C(d),J[0]),e?7:-9);d=B(y(C(d),J[7]),e?9:-7);h=h.or(d);if(!u(h,c))return!0;h=T(a,1,b);if(!t(C(Da[c]).and(h)))return!0;h=T(a,5,b);if(!t(C(Ea[c]).and(h)))return!0;h=Oa(a);d=T(a,4,b);e=C(T(a,2,b)).or(d);e=Qa(e,h);if(!u(e,c))return!0;a=C(T(a,3,b)).or(d);a=Ra(a,h);return u(a,c)?!1:!0}function Y(a,b,c){M(a.b,1538+a.g);a.g&=~(1<<b+(c?0:2));M(a.b,1538+a.g)}
function Sa(a,b,c){if(0===(a.g&1<<b+(c?0:2)))return!1;var d=c?1:-1,e=0===b?4:60,h=Oa(a);(d=!u(h,e+d)||!u(h,e+2*d)||!c&&!u(h,e+3*d))||(d=b^1,c=c?1:-1,b=0===b?4:60,d=!(!Pa(a,d,b)&&!Pa(a,d,b+c)&&!Pa(a,d,b+2*c)));return d?!1:!0}function Ta(a){var b=a.b;return 3<=a.m.reduce(function(c,d){return c+(d.b===b.b&&d.a===b.a?1:0)},0)}
function Ua(a){if(!t(a.a[0])||!t(a.a[3])||!t(a.a[4]))return!1;if(4>ia(a.a[6])+ia(a.a[7]))return!0;if(!t(a.a[1]))return!1;a=a.a[2];return ma(C(a).and(wa),a)||ma(C(a).and(xa),a)?!0:!1}function Va(a){return 100<=a.l||Ta(a)||Ua(a)}
function Na(a,b){function c(F,D,Q){for(;!t(F);){var S=q(F);h.push(new Ia(S-D,S,Q,0,K.h[S]))}}function d(F,D,Q){c(C(F),D,Q?15:11);c(C(F),D,Q?14:10);c(C(F),D,Q?13:9);c(C(F),D,Q?12:8)}function e(F,D,Q){for(;!t(D);){var S=q(D);h.push(new Ia(F,S,u(n,S)?0:4,Q,K.h[S]))}}var h=[],k=a.c,n=a.a[6+(k^1)],r=Oa(a),K=a,v=1-2*k,l=8*v,m=T(a,0,k),g=L[k?0:7];if(!b){var p=y(y(B(C(m).and(L[k?6:1]),2*l),r),B(C(r),l));c(p,2*l,1);p=y(B(C(m),l),r);c(y(C(p),g),l,0);d(C(p).and(g),l,!1)}var x=J[k?7:0];p=l-v;var G=B(y(C(m),x),
p).and(n);c(y(C(G),g),p,4);d(C(G).and(g),p,!0);G=J[k?0:7];l+=v;var I=B(y(C(m),G),l).and(n);c(y(C(I),g),l,4);d(C(I).and(g),l,!0);0<=a.f&&(g=B(y(H(a.f+v).and(m),x),p),c(g,p,5),v=B(y(H(a.f-v).and(m),G),l),c(v,l,5));v=la(C(a.a[6+k]));b&&v.and(n);for(m=C(T(a,1,k));!t(m);)g=q(m),e(g,C(Da[g]).and(v),1);for(m=C(T(a,4,k));!t(m);)g=q(m),e(g,Qa(H(g),r).or(Ra(H(g),r)).and(v),4);for(m=C(T(a,2,k));!t(m);)g=q(m),e(g,Qa(H(g),r).and(v),2);for(m=C(T(a,3,k));!t(m);)g=q(m),e(g,Ra(H(g),r).and(v),3);r=ja(T(a,5,k));e(r,
C(Ea[r]).and(v),5);b||(Sa(a,k,!0)&&h.push(new Ia(r,r+2,2,5,null)),Sa(a,k,!1)&&h.push(new Ia(r,r-2,3,5,null)));return h}function Wa(a,b,c,d,e){var h=H(d).or(H(e));a.a[b].xor(h);a.a[6+c].xor(h);a.h[d]=null;a.h[e]=b;M(a.b,2+b+6*c+12*d);M(a.b,2+b+6*c+12*e)}function Xa(a,b,c,d,e){ka(a.a[b],e);w(a.a[c],e);a.h[e]=c;M(a.b,2+b+6*d+12*e);M(a.b,2+c+6*d+12*e)}
function Ya(a,b){if(P(b)&4){var c=b.value>>>19&7,d=a.c^1,e=Ka(b);ka(a.a[c],e);ka(a.a[6+d],e);a.h[e]=null;M(a.b,2+c+6*d+12*e)}Ja(b)&&(c=a.c,d=2===P(b),e=U[c+(d?0:2)],Wa(a,3,c,e,e+(d?-2:3)));Wa(a,R(b),a.c,O(b),b.value&63);P(b)&8&&Xa(a,0,P(b)&8?1+(P(b)&3):0,a.c,b.value&63)}
function Za(a,b){P(b)&8&&Xa(a,P(b)&8?1+(P(b)&3):0,0,a.c,b.value&63);Wa(a,R(b),a.c,b.value&63,O(b));if(Ja(b)){var c=a.c,d=2===P(b),e=U[c+(d?0:2)];Wa(a,3,c,e+(d?-2:3),e)}P(b)&4&&(c=b.value>>>19&7,d=a.c^1,b=Ka(b),w(a.a[c],b),w(a.a[6+d],b),a.h[b]=c,M(a.b,2+c+6*d+12*b))}La.prototype.o=function(a){Ya(this,a);var b=W(this);Za(this,a);return!b};
function Z(a,b){var c=a.b;a.m.push(new Fa(c.b,c.a));Ya(a,b);if(W(a))return Za(a,b),a.m.pop(),!1;a.i.push(b);a.j.push(a.f);a.j.push(a.g);a.j.push(a.l);N(a.b,a.f);a.f=1===P(b)?b.value&63:-1;N(a.b,a.f);c=a.c;5===R(b)?(Y(a,c,!0),Y(a,c,!1)):3===R(b)&&(O(b)===U[c+0]?Y(a,c,!0):O(b)===U[c+2]&&Y(a,c,!1));c^=1;3===(b.value>>>19&7)&&(Ka(b)===U[c+0]?Y(a,c,!0):Ka(b)===U[c+2]&&Y(a,c,!1));P(b)&4||0===R(b)?a.l=0:++a.l;a.c=c;M(a.b,0);return!0}
function $a(a){if(a.i.length){var b=a.i.pop();a.c^=1;M(a.b,0);Za(a,b);a.j.pop();M(a.b,1538+a.g);a.g=a.j.pop();M(a.b,1538+a.g);N(a.b,a.f);a.f=a.j.pop();N(a.b,a.f);a.m.pop()}};var ab=[100,300,300,500,900,2E4],bb=[[0,0,0,0,0,0,0,0,50,50,50,50,50,50,50,50,10,10,20,30,30,20,10,10,5,5,10,25,25,10,5,5,0,0,0,20,20,0,0,0,5,-5,-10,0,0,-10,-5,5,5,10,10,-20,-20,10,10,5,0,0,0,0,0,0,0,0],[-50,-40,-30,-30,-30,-30,-40,-50,-40,-20,0,0,0,0,-20,-40,-30,0,10,15,15,10,0,-30,-30,5,15,20,20,15,5,-30,-30,0,15,20,20,15,0,-30,-30,5,10,15,15,10,5,-30,-40,-20,0,5,5,0,-20,-40,-50,-40,-30,-30,-30,-30,-40,-50],[-20,-10,-10,-10,-10,-10,-10,-20,-10,0,0,0,0,0,0,-10,-10,0,5,10,10,5,0,-10,-10,5,5,10,10,
5,5,-10,-10,0,10,10,10,10,0,-10,-10,10,10,10,10,10,10,-10,-10,5,0,0,0,0,5,-10,-20,-10,-10,-10,-10,-10,-10,-20],[0,0,0,0,0,0,0,0,5,10,10,10,10,10,10,5,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,0,0,0,5,5,0,0,0],[-20,-10,-10,-5,-5,-10,-10,-20,-10,0,0,0,0,0,0,-10,-10,0,5,5,5,5,0,-10,-5,0,5,5,5,5,0,-5,0,0,5,5,5,5,0,-5,-10,5,5,5,5,5,0,-10,-10,0,5,0,0,0,0,-10,-20,-10,-10,-5,-5,-10,-10,-20],[-30,-40,-40,-50,-50,-40,-40,-30,-30,-40,-40,-50,-50,-40,-40,-30,-30,
-40,-40,-50,-50,-40,-40,-30,-30,-40,-40,-50,-50,-40,-40,-30,-20,-30,-30,-40,-40,-30,-30,-20,-10,-20,-20,-20,-20,-20,-20,-10,20,20,0,0,0,0,20,20,20,30,10,0,0,10,30,20]],cb=ab[0]/2;function db(a,b){for(var c=0,d=0;5>d;++d)c+=ia(T(a,d,b))*ab[d];1<ia(T(a,2,b))&&(c+=cb);return c}function eb(a,b){for(var c=0,d=0;5>=d;++d)for(var e=C(T(a,d,b));!t(e);){var h=q(e);c+=bb[d][b?h:56^h]}return c}
function fb(a){function b(l){function m(g){var p=P(g)&4?(1+(g.value>>>19&7))/(1+R(g)):0;p=6*p+R(g);p=16*p+P(g);p=64*p+(g.value&63);return p=64*p+O(g)}l.sort(function(g,p){return m(p)-m(g)});return l}function c(l,m,g){if(Va(l))return 0;var p=db(l,0)-db(l,1);var x=eb(l,0)-eb(l,1);x=p+x;++e;if(p=0===l.c){if(x>=g)return g;m=x>m?x:m}else{if(x<=m)return m;g=x<g?x:g}x=b(V(l,!0,!W(l)));for(var G=0;G<x.length;++G)if(Z(l,x[G])){var I=c(l,m,g);$a(l);if(p){if(I>=g)return g;m=I>m?I:m}else{if(I<=m)return m;g=I<
g?I:g}}return p?m:g}function d(l,m,g,p){if(1>m)return c(l,g,p);for(var x=b(V(l,!0,!1)),G=0===l.c,I=!1,F=0;F<x.length;++F)if(Z(l,x[F])){I=!0;var D=d(l,m-1,g,p);$a(l);G?g=D>g?D:g:p=D<p?D:p;if(p<=g)break}if(!I){if(!W(l))return 0;l=ab[5];return G?-l:l}return Va(l)?0:G?g:p}for(var e=0,h=null,k=-Infinity,n=Infinity,r=b(V(a,!0)),K=0;K<r.length;++K)if(Z(a,r[K])){var v=d(a,3,k,n);$a(a);0===a.c?v>k&&(k=v,h=r[K]):v<n&&(n=v,h=r[K])}return h};function gb(){this.a=new La}
function hb(){var a=$("<table>"),b="<tr><th></th>"+"abcdefgh".split("").map(function(K){return'<th class="file">'+K+"</th>"}).join("")+"<th></th></tr>";a.append(b);for(var c=0;8>c;++c){var d=7-c,e=$("<tr>");a.append(e);var h='<th class="rank">'+(8-c)+"</th>";e.append(h);for(var k=0;8>k;++k){var n=$("<td>"),r=(d+k)%2?"light":"dark";n.attr("id",ba(d,k));n.attr("title","Algebraic: "+ba(d,k)+"\nRank: "+d+"\nFile: "+k+"\nIndex: "+(k+8*d)+"\nColor: "+r);n.addClass(r);e.append(n)}e.append(h)}a.append(b);$("#chessboard").append(a)}
function ib(){$("#chessboard table tr td, #chessboard table tr td div").removeClass("from to positional capture double-push en-passant promotion castle king-castle queen-castle")}function jb(){$("#chessboard table tr td div.ui-draggable").draggable("destroy");$("#chessboard table tr td.ui-droppable").droppable("destroy")}
function kb(a){var b=V(a.a);$("#moves").html('<a href="#" id="undo" class="'+(a.a.i.length?"can":"cannot")+'">undo</a><br/><a href="#" id="auto" class="'+(0<b.length?"can":"cannot")+'">auto</a><br/>'+b.map(function(d,e){return'<a href="#" class="tag" id="'+e+'">'+(Ja(d)?"0-0"+(3===P(d)?"-0":""):" NBRQK".charAt(R(d))+f(O(d))+(P(d)&4?"x":"-")+f(d.value&63)+(5===P(d)?"e.p.":"")+(P(d)&8?" NBRQK".charAt(P(d)&8?1+(P(d)&3):0):""))+"</a><br/>"}).join(""));$("#chessboard table tr td, #chessboard table tr td div").removeClass("can-move");
b.forEach(function(d){d=$("#"+f(O(d)));d.add(d.children()).addClass("can-move")});var c=!1;$("#chessboard table tr td div.can-move").mouseenter(function(){if(!c){var d=$(this),e=d.parent(),h=ca(""+e.attr("id"));e=e.add(d);e.toggleClass("from",b.some(function(k){return O(k)===h}));e.hasClass("from")&&(b.forEach(function(k){if(O(k)===h){var n=$("#"+f(k.value&63));n=n.add(n.children());n.addClass("to");n.addClass(0===P(k)?"positional":"");n.addClass(P(k)&4?"capture":"");n.addClass(1===P(k)?"double-push":
"");n.addClass(5===P(k)?"en-passant":"");n.addClass(P(k)&8?"promotion":"");n.addClass(Ja(k)?"castle":"");n.addClass(2===P(k)?"king-castle":"");n.addClass(3===P(k)?"queen-castle":"")}}),jb(),$("#chessboard table tr td.to").droppable({drop:function(){var k=ca(""+$(this).attr("id")),n=b.filter(function(r){return O(r)===h&&(r.value&63)===k});0<n.length?(Z(a.a,n[0]),lb(a)):(ib(),jb())}}),d.draggable({start:function(){c=!0},stop:function(){c=!1},containment:"#chessboard table",zIndex:10,revert:"invalid"}))}}).mouseleave(function(){c||
ib()});$("#moves a").click(function(){var d=$(this).attr("id");"undo"===d?($a(a.a),$a(a.a),lb(a)):"auto"===d?mb(a):(Z(a.a,b[parseInt(d,10)]),lb(a))})}
function mb(a){$("#moves").html("");var b=$("#dim");b.fadeIn(function(){var c=fb(a.a);if(!c)throw Error("Move not found");Z(a.a,c);var d=$("#"+f(O(c)));c=$("#"+f(c.value&63));var e=c.offset().left-d.offset().left,h=c.offset().top-d.offset().top,k=d.children("div");k.css({position:"relative",top:"0px",left:"0px"});b.fadeOut(function(){k.animate({top:h+"px",left:e+"px"},function(){lb(a)})})})}
function lb(a){ib();jb();$("#chessboard table tr td div").remove();$("#chessboard table tr td").removeClass("white black turn last-move "+aa.join(" "));for(var b=a.a.a[6],c=a.a.a[7],d=0;64>d;++d)for(var e=$("#"+f(d)),h=0;5>=h;++h)if(!u(a.a.a[h],d)){var k=0===a.a.c?!u(b,d):!u(c,d),n=$("<div>");n.attr("title",e.attr("title")+"\nPiece: "+aa[h]+"\nColor: "+(u(b,d)?"black":"white"));n.text("\u2659\u265f\u2658\u265e\u2657\u265d\u2656\u265c\u2655\u265b\u2654\u265a".charAt(2*h+(u(b,d)?1:0)));var r=n.add(e);
r.addClass(aa[h]);r.toggleClass("white",!u(b,d));r.toggleClass("black",!u(c,d));r.toggleClass("turn",k);e.append(n);break}b=a.a;b=b.i.length?b.i[b.i.length-1]:null;null!==b&&($("#"+f(O(b))).addClass("last-move"),$("#"+f(b.value&63)).addClass("last-move"));b=a.a;b=V(b).length?100<=b.l?3:Ta(b)?4:Ua(b)?5:0:W(b)?1:2;0===b&&1===a.a.c?mb(a):(kb(a),$("#dim").css({display:"none"}),1===b?$("#moves").append("&#35;<br/>"+(a.a.c?"1-0":"0-1")):0!==b&&$("#moves").append("&frac12;-&frac12;"))};window.makeChessGame=function(){hb();lb(new gb)};})();
